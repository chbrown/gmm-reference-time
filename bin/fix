#!/bin/bash

stop-all.sh

for slavehost in `cat $HADOOP_CONF_DIR/slaves`; do
  echo "ssh $slavehost 'rm -rf /hadoop/$USER'"
  ssh -Y $slavehost "rm -rf /hadoop/$USER"
done
rm -rf /hadoop/$USER

cd $HADOOP_CONF_DIR
sed -e "s|NAMENODE|$NAMENODE|g" mapred-site.xml.default | sed -e "s|USER|$USER|g" > mapred-site.xml
sed -e "s|NAMENODE|$NAMENODE|g" core-site.xml.default | sed -e "s|USER|$USER|g" > core-site.xml
sed -e "s|NAMENODE|$NAMENODE|g" hdfs-site.xml.default | sed -e "s|USER|$USER|g" > hdfs-site.xml

$HADOOP_HOME/bin/hadoop namenode -format
$HADOOP_HOME/bin/start-all.sh
