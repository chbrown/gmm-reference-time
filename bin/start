#!/bin/bash

HOURS=$1
MACHINES=$2
JOBNAME=${3-'HadoopJob'}      # Defaults to "HadoopJob"

CORES=`expr $MACHINES \\* 8`   # 8 cores per machine

if [[ $HOURS ]] && [[ $CORES ]]; then
  echo "rm -rf $HADOOP_LOG_DIR"
  rm -rf $HADOOP_LOG_DIR

  cd $TACC_HADOOP/hadoop-templates
  cat hadoop.job.template | sed \
    -e "s/JOBNAME/$JOBNAME/" \
    -e "s/CORES/$CORES/" \
    -e "s/HOURS/$HOURS/" \
    -e "s/TACC_PROJECT_NAME/$TACC_PROJECT_NAME/" > hadoop.job

  qsub $TACC_HADOOP/hadoop-templates/hadoop.job
else
  echo "Usage: $0 NUM_HOURS NUM_MACHINES JOB_NAME"
  echo "Example Usage: $0 1 3 HadoopWordCount"
fi
